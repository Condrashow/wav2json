<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Wav2json by beschulz</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style type="text/css">
      .waveform
      {
        width: 45%;
        height: 100px;
        margin-top   : 16px;
        margin-bottom: 24px;
        margin-right: 5%;
        display: inline-block;
      }

      .seperator
      {
        border-bottom: 1px dashed silver;
        padding-top: 24px;
      }

      .seperator:last-child
      {
        border: 0;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Wav2json</h1>
        <p class="header">Generate waveformjs.org compatible json data out of wav files.</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/beschulz/wav2json/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/beschulz/wav2json/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/beschulz/wav2json">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/beschulz">beschulz</a></p>


      </header>
      <section>
        <h1>wav2json</h1>

<p>Generate waveformjs.org compatible json data out of wav files.</p>

<p>Author: Benjamin Schulz</p>

<p>email: beschulz[the a with the circle]betabugs.de  </p>

<p>License: GPL</p>

<p>Note: the file examples/waveform.js is from <a href="http://waveformjs.org/">http://waveformjs.org/</a></p>

<p>This application is based on <a href="https://github.com/beschulz/wav2png/">wav2png</a> but does generate json data instead of pngs.</p>

<h1>Examples</h1>

<pre><code>wav2json song.wav --channels left right -o song.json
</code></pre>

<p>might produce output like</p>

<pre><code>{
    "left":[0,0.499969,0.865997,0.999969,0.865997,0.499969,0,0.5,0.866028,0,0.866028,0.5],
    "right":[0,0.499969,0.865997,0.999969,0.865997,0.499969,0,0.5,0.866028,0,0.866028,0.5],
}
</code></pre>

<p id="examples"></p>
  <script type="text/javascript" src="https://raw.github.com/beschulz/wav2json/master/examples/waveform.js"></script>
  <!--script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script-->
  <script type="text/javascript" src="http://waveformjs.org/waveform.js"></script>
  <script>
    function render_waveform(container_id, samples)
    {
      // create waveform object
      var test = new Waveform({container: document.getElementById(container_id)});

      //create a gradient
      var ctx = test.context;
      var gradient = ctx.createLinearGradient(0, 0, 0, test.height);
      gradient.addColorStop(0.0, "#de0121");
      gradient.addColorStop(1.0, "#a60011");
      test.innerColor = gradient;

      // draw the waveform
      test.update({data: samples});
    }

    function load_example(name)
    {
      $('#examples').append($('<h2>' + name + '.json</h2>')); 
      $('#examples').append($('<div class="waveform" id="' + name + '_left">left channel</div>'));
      $('#examples').append($('<div class="waveform" id="' + name + '_right">right channel</div>'));
      $('#examples').append($('<div class="waveform" id="' + name + '_mid">mid channel</div>'));
      $('#examples').append($('<div class="waveform" id="' + name + '_side">side channel</div>'));
      $('#examples').append($('<div class="waveform" id="' + name + '_min">minimum of the channels</div>'));
      $('#examples').append($('<div class="waveform" id="' + name + '_max">maximum of the channels</div>'));
      $('#examples').append($('<div class="seperator"></div>'));

      $.getJSON(name + '.json', function(samples)
      {
        render_waveform(name + '_left' , samples.left);
        render_waveform(name + '_right', samples.right);
        render_waveform(name + '_mid'  , samples.mid);
        render_waveform(name + '_side' , samples.side);
        render_waveform(name + '_min'  , samples.min);
        render_waveform(name + '_max'  , samples.max);
      });
    }

    $(function(){
      load_example('test3');
      load_example('test2');
      load_example('test1');
    });
  </script>

<h1>Performance</h1>

<p>Similar to wav2png (e.g. very good). But it might be a little slower, when generating output for multiple channels.
Since the input file is opened multiple times, I'd recommend to write it to a temporary file first, so you can take advantage of the operating systems file cache:</p>

<pre><code>sox ../song.mp3 -c 2 -t wav tmp.wav
wav2json tmp.wav --channels left right mid side min max -o song.json
rm tmp.wav
</code></pre>

<p>Also note, that you can dramatically reduce the file size, by reducing the precision of the output. In my tests, even a precision of 1 looked good.</p>

<h1>Installation</h1>

<h2>On Linux (Ubuntu, Debian)</h2>

<h3>install dependencies</h3>

<pre><code>apt-get install make g++ libsndfile1-dev libboost-program-options-dev
</code></pre>

<h3>Build</h3>

<pre><code>cd build
make all
</code></pre>

<h2>On Max OS</h2>

<h3>install dependencies</h3>

<ul>
<li>Get the Xcode command line tools

<ul>
<li>Starting with Xcode 4.3, Apple does not install command line tools by default anymore, so after Xcode installation, go to Preferences &gt; Downloads &gt; Components &gt; Command Line Tools and click Install. You can also directly <a href="https://developer.apple.com/downloads">download Command Line Tools</a> for Xcode without getting Xcode.</li>
</ul>
</li>
<li><a href="https://github.com/mxcl/homebrew/wiki/installation">Install homebrew</a></li>
<li>install libsndfile: in the shell: brew install libsndfile</li>
</ul><h3>Build</h3>

<ul>
<li>in the shell: cd build &amp;&amp; make all</li>
</ul><h1>Usage</h1>

<pre><code>wav2json version 0.2
written by Benjamin Schulz (beschulz[the a with the circle]betabugs.de)

usage: wav2json [options] input_file_name
example: wav2json my_file.wav

Allowed options:

Generic options:
  -v [ --version ]      print version string
  --help                produce help message

Configuration:
  -s [ --samples ] arg (=800)           number of samples to generate
  --channels arg (=left right )         channels to compute: left, right, mid, 
                                        side, min, max
  -p [ --precision ] arg (=6)           precision of the floats, that are 
                                        generated. [1..6], reduce for smaller 
                                        sized files. Usually 2 should be 
                                        sufficient!
  -o [ --output ] arg                   name of output file, defaults to &lt;name 
                                        of inputfile&gt;.json
  -c [ --config-file ] arg (=wav2json.cfg)
                                        config file to use
  -d [ --db-scale ]                     use logarithmic (e.g. decibel) scale 
                                        instead of linear scale
  --db-min arg (=-48)                   minimum value of the signal in dB, that
                                        will be visible in the waveform
  --db-max arg (=0)                     maximum value of the signal in dB, that
                                        will be visible in the waveform. 
                                        Usefull, if you now, that your signal 
                                        peaks at a certain level.
  -n [ --no-header ]                    Do not include the version info banner 
                                        in the output
</code></pre>

<p>One thing, thats noteworthy is, that you can generate output for multiple cahannels:</p>

<ul>
<li>left is the left channel of the audio file.</li>
<li>right is the right channel of the audio file</li>
<li>mid is the mid channel of the audio file computed per sample as: mid = (left + right) / 2</li>
<li>side is the side channel of the audio file computed per sample as: side = (left + right) / 2</li>
<li>max is the maximum of the channels of the audio file computed per sample as: max = max(left, right)</li>
<li>min is the minimum of the channels of the audio file computed per sample as: min = min(left, right)</li>
</ul><p>Obviously outputting the right, mid, side, min, max channels does only make sense on stereo input. When the input is mono,
the applications falls back to outputing the left channel and prints a warning to stderr.</p>

<p>When there are more than two channels present, the output might be a little non-sensical, depending on what information is stored in the first and second channel.</p>

<p>Also note, that if there are less samples in the audio file, than defined by --samples, only as many samples as there are in the audio file will be written to the json file. The interpolation should be done by waveform.js</p>

<h1>Donations</h1>

<p>If you find wav2png incredibly usefull nd use it a lot, feel free to make a small <a href="http://goo.gl/Ey2Bp">donation via paypal</a>.
While it is highly appreciated, it is absolutely not necessary to us the software.</p>

<p>If you find any issues, feel free to contact me.
and most important: enjoy and have fun :D</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-16109569-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>